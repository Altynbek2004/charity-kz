<template>
    <div class="bg-gray-100 py-10 min-h-screen flex justify-center items-start">
        <div class="w-full max-w-5xl bg-white rounded-xl shadow-lg flex overflow-hidden">
            <!-- Sidebar -->
            <aside class="w-1/4 bg-green-900 text-white p-6">
                <h2 class="text-2xl font-bold mb-6">–ú”ô–∑—ñ—Ä</h2>
                <ul class="space-y-4">
                    <li>
                        <button
                            @click="showSection = 'profile'"
                            :class="{ 'text-green-300 font-semibold': showSection === 'profile' }"
                            class="w-full text-left hover:text-green-300 transition-all"
                        >
                            –ú–µ–Ω—ñ“£ –ø—Ä–æ—Ñ–∏–ª—ñ–º
                        </button>
                    </li>
                    <li>
                        <button
                            @click="showSection = 'achievements'"
                            :class="{ 'text-green-300 font-semibold': showSection === 'achievements' }"
                            class="w-full text-left hover:text-green-300 transition-all"
                        >
                            –ú–µ–Ω—ñ“£ –∂–µ—Ç—ñ—Å—Ç—ñ–∫—Ç–µ—Ä—ñ–º
                        </button>
                    </li>
                    <li>
                        <button
                            @click="showSection = 'donations'"
                            :class="{ 'text-green-300 font-semibold': showSection === 'donations' }"
                            class="w-full text-left hover:text-green-300 transition-all"
                        >
                            “ö–∞–π—ã—Ä—ã–º–¥—ã–ª—ã“õ —Ç–∞—Ä–∏—Ö—ã
                        </button>
                    </li>
                    <li>
                        <button
                            @click="showSection = 'subscriptions'"
                            :class="{ 'text-green-300 font-semibold': showSection === 'subscriptions' }"
                            class="w-full text-left hover:text-green-300 transition-all"
                        >
                            –ú–µ–Ω—ñ“£ –∂–∞–∑—ã–ª–º–∞–ª–∞—Ä—ã–º
                        </button>
                    </li>
                    <li>
                        <button
                            @click="showSection = 'cards'"
                            :class="{ 'text-green-300 font-semibold': showSection === 'cards' }"
                            class="w-full text-left hover:text-green-300 transition-all"
                        >
                            –ú–µ–Ω—ñ“£ –∫–∞—Ä—Ç–∞–ª–∞—Ä—ã–º
                        </button>
                    </li>
                    <li>
                        <button
                            @click="createGroup"
                            class="w-full text-left hover:text-green-300 transition-all"
                        >
                            –ö”©–º–µ–∫ –∫–µ—Ä–µ–∫ —Ç–æ–ø—Ç—ã “õ“±—Ä—É
                        </button>
                    </li>
                    <li>
                        <button
                            @click="listGroupHelp"
                            :class="{ 'text-green-300 font-semibold': showSection === 'groups' }"
                            class="w-full text-left hover:text-green-300 transition-all"
                        >
                            –ö”©–º–µ–∫ –∫–µ—Ä–µ–∫ —Ç–æ–ø
                        </button>
                    </li>
                    <li>
                        <button
                            @click="logout"
                            class="w-full text-left hover:text-red-400 transition-all"
                        >
                            –ê–∫–∫–∞—É–Ω—Ç—Ç–∞–Ω —à—ã“ì—É
                        </button>
                    </li>
                </ul>
            </aside>

            <!-- Main Content -->
            <main class="w-3/4 p-10 bg-gray-50">
                <!-- Profile Section -->
                <section
                    v-show="showSection === 'profile'"
                    class="transition-opacity duration-300"
                    :class="{ 'opacity-100': showSection === 'profile', 'opacity-0 absolute': showSection !== 'profile' }"
                >
                    <!-- Profile photo -->
                    <div class="flex items-center mb-8">
                        <div class="w-24 h-24 rounded-full bg-gray-300 flex items-center justify-center relative overflow-hidden">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-12 w-12 text-gray-600"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M5.121 17.804A7.5 7.5 0 0112 15.75a7.5 7.5 0 016.879 2.054M15 11a3 3 0 10-6 0 3 3 0 006 0z"
                                />
                            </svg>
                            <div class="absolute bottom-0 right-0 bg-orange-400 p-1 rounded-full text-white">üì∑</div>
                        </div>
                        <div class="ml-6">
                            <h2 class="text-3xl font-bold">{{ user.email || '–ê—Ç—ã“£—ã–∑' }}</h2>
                            <p class="text-gray-600 mt-1"></p>
                        </div>
                    </div>

                    <!-- Email info -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            –°—ñ–∑ ”©–∑ email –ø–æ—à—Ç–∞“£—ã–∑–¥—ã –∫”©—Ä—Å–µ—Ç–ø–µ–≥–µ–Ω—Å—ñ–∑
                        </label>
                        <div class="flex items-center bg-gray-100 p-2 rounded-md">
                            <input type="checkbox" class="mr-2" />
                            <span>–ñ–∞“£–∞–ª—ã“õ—Ç–∞—Ä“ì–∞ –∂–∞–∑—ã–ª—ã“£—ã–∑</span>
                        </div>
                    </div>

                    <!-- Donation info -->
                    <div class="bg-green-800 text-white py-4 px-6 rounded-md text-lg font-semibold mb-6">
                        –°—ñ–∑–¥—ñ“£ “Ø–ª–µ—Å—ñ“£—ñ–∑: <span class="ml-2 font-bold">0 ‚Ç∏</span>
                    </div>

                    <!-- Success message -->
                    <div
                        v-if="successMessage"
                        class="bg-green-100 text-green-700 p-4 rounded-lg mb-4"
                    >
                        {{ successMessage }}
                    </div>

                    <!-- Profile form -->
                    <form @submit.prevent="submitProfile" class="space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700"
                            >–ï—Å—ñ–º—ñ“£—ñ–∑</label
                            >
                            <input
                                type="text"
                                v-model="form.name"
                                class="mt-2 w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                                placeholder="–ê—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑"
                            />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700"
                            >–¢–µ–≥—ñ“£—ñ–∑</label
                            >
                            <input
                                type="text"
                                v-model="form.surname"
                                class="mt-2 w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                                placeholder="–¢–µ–≥—ñ“£—ñ–∑–¥—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑"
                            />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700"
                            >–ñ—ã–Ω—ã—Å—ã“£—ã–∑</label
                            >
                            <select
                                v-model="form.gender"
                                class="mt-2 w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                            >
                                <option value="female">”ò–π–µ–ª –∞–¥–∞–º</option>
                                <option value="male">–ï—Ä –∞–¥–∞–º</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700"
                            >–¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ“£—ñ–∑</label
                            >
                            <input
                                type="text"
                                v-model="form.phone"
                                class="mt-2 w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                                placeholder="+7 777 777 77 77"
                            />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700"
                            >“ö–∞–ª–∞“£—ã–∑</label
                            >
                            <select
                                v-model="form.city"
                                class="mt-2 w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                            >
                                <option value="almaty">–ê–ª–º–∞—Ç—ã</option>
                                <option value="astana">–ê—Å—Ç–∞–Ω–∞</option>
                                <option value="shymkent">–®—ã–º–∫–µ–Ω—Ç</option>
                            </select>
                        </div>
                        <button
                            type="submit"
                            class="w-full bg-green-800 text-white py-3 rounded-lg hover:bg-green-700 transition"
                        >
                            –°–∞“õ—Ç–∞—É
                        </button>
                    </form>
                </section>

                <!-- Helps Section -->
                <section
                    v-show="showSection === 'groups'"
                    class="mt-4 transition-opacity duration-300 overflow-x-auto"
                    :class="{ 'opacity-100': showSection === 'groups', 'opacity-0 absolute': showSection !== 'groups' }"
                >
                    <h2 class="text-3xl font-bold mb-6">–ö”©–º–µ–∫ –∫–µ—Ä–µ–∫ —Ç–æ–ø</h2>
                    <table
                        v-if="helps.length"
                        class="w-full bg-white border border-gray-300 rounded-lg overflow-hidden"
                    >
                        <thead>
                        <tr class="bg-gray-100">
                            <th class="py-3 px-4 border-b">–ò–º—è</th>
                            <th class="py-3 px-4 border-b">–§–∞–º–∏–ª–∏—è</th>
                            <th class="py-3 px-4 border-b">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</th>
                            <th class="py-3 px-4 border-b">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</th>
                            <th class="py-3 px-4 border-b">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</th>
                            <th class="py-3 px-4 border-b">–î–æ–∫—É–º–µ–Ω—Ç—ã, —Ñ–∞–π–ª—ã, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="help in helps" :key="help.id" class="hover:bg-gray-50">
                            <td class="py-3 px-4 border-b">{{ help.name }}</td>
                            <td class="py-3 px-4 border-b">{{ help.surname }}</td>
                            <td class="py-3 px-4 border-b">{{ help.number }}</td>
                            <td class="py-3 px-4 border-b">{{ help.email }}</td>
                            <td class="py-3 px-4 border-b">{{ help.info }}</td>
                            <td class="py-3 px-4 border-b">
                                <a
                                    :href="`/${help.file}`"
                                    target="_blank"
                                    class="text-blue-500 underline"
                                >
                                    {{ help.file.split('/').pop() }}
                                </a>
                            </td>

                        </tr>
                        </tbody>
                    </table>
                    <p v-else class="text-gray-600">–¢—ñ–∑—ñ–º –±–æ—Å</p>
                </section>
            </main>
        </div>
    </div>
</template>

<script>
import axios from "axios";
export default {
    data() {
        return {
            showSection: 'profile',
            form: {
                name: '',
                surname: '',
                gender: 'male',
                phone: '',
                city: 'almaty',
            },
            successMessage: '',
            helps: [],
            user:{},
        };
    },

    async created(){
      try{
          const response = await axios.get('/user');
          this.user = response.data;
      }  catch (er) {
        console.log("“ö–æ–ª–¥–∞–Ω—É—à—ã–Ω—ã“£ –¥–∞–Ω–Ω—ã–π—ã–Ω –∞–ª—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ–ª—ñ–∫ —Ç—É–¥—ã.",er);
      }
    },

    methods: {
        async submitProfile() {
            try {
                const response = await axios.post('/profile', this.form);
                this.successMessage = response.data.message;
                // –°–±—Ä–æ—Å –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
                this.form = {
                    name: '',
                    surname: '',
                    gender: 'male',
                    phone: '',
                    city: 'almaty'
                };
            } catch (e) {
                console.error(e);
            }
        },
        createGroup() {
            this.$router.push('/create/group');
        },
        logout() {
            localStorage.removeItem('isLoggedIn');
            this.$router.push('/');
            alert('–°”ô—Ç—Ç—ñ —à—ã“õ—Ç—ã“£—ã–∑!');
        },
        async listGroupHelp() {
            this.showSection = 'groups';
            try {
                const response = await axios.get('/get-helps');
                this.helps = response.data;
            } catch (error) {
                console.error("–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∞–ª—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ:", error);
            }
        },

    }
};
</script>
